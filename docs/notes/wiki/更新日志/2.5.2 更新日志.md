---
title: 2.5.2 更新日志
icon: ic:sharp-update
createTime: 2025/11/23 19:54:20
permalink: /wiki/log/252/
tags:
  - 更新日志
---

## Bug 修复

- 修复旧版 YSM 加密格式导致的手部动画异常问题
- 修复仅客户端运行时，跨服传送可能导致的掉线问题
- 修复与 Better Combat 模组兼容时，头部隐藏功能的异常问题
- 修正模型背景图和前景图的尺寸限制，最大支持 260×450 像素
- 修复部分服务端（特别是 Linux 服务端）因配置目录路径格式不规范导致的启动失败问题
  - 服务端读取默认模型失败时，现在会显示准确的错误信息
- 修复玩家同时处于发光和隐身状态时轮廓渲染异常的问题
- 修复特定情况下 GUI 动画播放异常的问题
- 修复使用 Carry On 模组抱起女仆时动画显示错误的问题
- 修复女仆切换模型时动画状态异常的问题
- 修复服务端未安装 YSM 时部分 Molang 变量无法正常更新的问题
- 修复调用 Molang 自定义函数时使用函数表达式传参导致的参数解析错误
- 修复获取方块信息的 Molang 函数对 Y 坐标分量处理错误的问题
- 修复特定条件下 ZIP 文件读取失败的问题
- 修复与 TaCZ Tweaks 模组的兼容性问题
- 修复 1.21.1 NeoForge 车万女仆无法使用 TaCZ 枪械射击的问题

## 性能优化

- 优化远距离和不可见实体的动画更新频率，减少性能消耗
- 改进玩家属性同步机制，有效降低服务端网络带宽使用
- 新增服务端配置选项：低带宽模式
- 自动清理服务端无效的玩家 roaming 数据，防止 NBT 数据过大
- 添加更多内存安全特性
- 客户端纹理压缩格式改为 WebP，显著降低内存占用

## 新增功能与内容修改

- 新增对 Linux 客户端的支持（注意：客户端无法在虚拟机环境下运行）
- 新增对 Android 客户端的支持
- 完善头戴物品的兼容性支持
- 新增对 Simple Hat（简单帽子）模组的兼容
- 改进投掷物和骑乘实体模型的实体匹配机制：
  - 支持配置多个实体 ID
  - 支持使用实体标签（tag）进行匹配
- 新增对 7z 压缩格式模型的支持，可解决 ZIP 格式出现乱码或读取失败的问题
  - 同时支持模型文件和模型包
  - 当 7z 压缩包大小超过 64MB 时，请关闭"固实压缩"功能，并将"固实数据大小"设置为不超过 64MB，然后重新压缩
  - 注意：固实数据越大压缩率越高，但加载速度会相应降低
- 全面重构音频系统，实现以下改进：
  - 采用流式解码技术，显著提升模型加载速度并降低内存占用
  - 优化 Opus 解码器，提供更高的音频质量
  - 新增动画控制器音效支持
  - 新增音频循环播放功能
  - 细化音频播放上下文管理，实现精确的生命周期控制
  - 保持音频 Molang 函数用法不变，但播放效果有显著改进（详见附录文档）
  - 建议使用 YSM 专用的 Opus 转码工具获得最佳效果
- 增强动画调试功能：
  - 支持调试远程玩家、女仆、投掷物和载具实体
  - 使用 `Alt + B` 组合键调试鼠标指向的实体
  - 新增 `/ysmclient debug <selector>` 命令，支持精确匹配实体进行调试
  - 新增 `/ysmclient molang execute <exp>` 命令，可在当前调试实体上执行 Molang 表达式
- 新增 Molang 变量：`q.delta_time`
- 优化硬编码控制器的缩放帧，禁用起始过渡动画
- 新增模型黑名单功能，可阻止指定默认模型的加载
  - 配置文件位置：`<游戏目录>/yes_steve_model/blacklist.txt`（文件内含详细说明）

- 为轮盘配置界面新增滚动功能，支持鼠标滚轮和按钮操作
- 新增针对单个玩家的 YSM 渲染控制功能
  - 命令格式：`/ysm model disable <玩家 ID> [true | false]`
- 新增酒狐模型：小酒狐和莫莫酒狐
- 为酒狐模型新增多种睡觉动画效果（制作者：小莫莫）

## Android 平台兼容与优化

- 支持 Android 系统下的 FCL、ZL 和 ZL2 启动器
  - 当检测到启动器版本过旧时，会在游戏内显示升级提示
- 新增多项移动端适配优化：
  - 优化轮盘配置界面按钮尺寸，提升移动设备操作体验
  - 在暂停菜单（ESC 界面）新增快捷按钮，可快速访问换肤、轮盘配置和纸娃娃配置界面
  - 放大纸娃娃配置界面的控制点，便于进行缩放、位移和旋转调整
  - 为纸娃娃配置界面新增重置按钮和显示/隐藏切换选项
- 优化 Android 端模型加载时的系统资源占用
- 改进 Android 系统的线程调度算法
- 修复安装 Touch Controller 模组后轮盘动画无法正常中断的问题
- **重要提示**：
  - YSM 和 Java 使用独立的内存池，两者可能存在内存竞争关系
  - 为 Java 分配过多内存可能导致 YSM 可用内存不足，请合理配置内存分配


## 音频系统更新文档

#### 动画控制器音效

blockbench 内制作动画控制器时附加的音效现在已支持，在进入该状态并执行完 “进入时” molang 后播放

![img](https://cdn.nlark.com/yuque/0/2025/png/26380667/1760795923007-704ee18a-e942-4708-a568-edcf47fb39dc.png)

### 音频播放上下文

#### 上下文分类

音频播放进程根据触发来源分为三种上下文类型：

- 动画上下文

通过动画音效帧、指令关键帧 Molang 和脚本控制器 Molang 触发的音频播放进程。当动画结束或进入下一轮循环时会自动停止。

![img](https://cdn.nlark.com/yuque/0/2025/png/26380667/1760799150630-6ba60f7f-9c6e-48ef-99d5-ae816e99b5d1.png)

- 动画控制器上下文

使用动画控制器添加的音效，以及在“进入时”和“退出时”molang 创建的播放进程属于该上下文。在当前动画控制器切换到其他状态时自动停止。

- 全局上下文

使用轮盘 molang、mc 指令执行 molang 和其他 molang 事件内创建的播放进程属于该上下文，不会自动停止。

此外，在切换模型、实体被移除、传送到其他维度时会强制停止所有的播放进程。

**注意事项**：

- 在脚本控制器中必须在执行 `set_animation` 或 `reset` 之后创建播放进程，否则播放进程将立即被重置
- 通过 `ysm.sync` 触发 `sync` 事件创建的播放进程属于全局上下文，而非 `ysm.sync` 所在的上下文

#### 主动停止

播放进程除了播放完毕后停止、上下文自动停止以外，还可使用 molang`ysm.stop_sound`和`ysm.stop_all_sounds`主动停止。在新版本加入了“上下文”的概念后，这种方法默认只能停止当前上下文的播放进程，对其他上下文无效。

此外，`ysm.stop_all_sounds`在过去版本仅停止由 molang 创建的播放进程，在新版本下还会停止由动画音效帧和动画控制器音效创建的播放进程。

### Molang 函数更新

音频相关的 Molang 函数在新版本中进行了功能扩展（如下图所示），所有三个函数的用法都得到了增强

![img](https://cdn.nlark.com/yuque/0/2025/png/26380667/1760798214506-3df5597b-97ed-4906-9148-62167f82a652.png)

#### 停止函数更新

`ysm.stop_sound` 和 `ysm.stop_all_sounds` 新增了可选参数 `global`：
- 当参数值为 1 时，停止全局上下文的播放进程
- 当参数值为 0 或未指定时，停止当前上下文的播放进程

**使用示例**：

```c
ysm.stop_sound('fx', 1)      // 停止全局上下文中 ID 为 'fx' 的播放进程
ysm.stop_all_sounds(0)       // 停止当前上下文中的所有播放进程
ysm.stop_all_sounds          // 停止当前上下文中的所有播放进程（默认行为）
```

#### 播放类型

如上图，`ysm.play_sound`的`boolean` 参数在过去的作用仅仅为“强制播放”，取值为 0 或 1。新版本该参数还可指定上下文和循环类型：

- 若要在忽略当前上下文，指定在全局上下文内创建播放进程，则在“强制播放”参数的基础上加 2；
- 若要指定循环播放，则在以上的基础上加 4。

如：

```c
ysm.play_sound('fx', 'sample', 1)
ysm.play_sound('fx', 'sample', 3)
ysm.play_sound('fx', 'sample', 7)
ysm.play_sound('fx', 'sample', 4)
```

#### 音频 ID 类型扩展

`ysm.play_sound` 的 `id` 参数现在支持更多数据类型：
- **字符串类型**（原有支持）
- **数值类型**（新增）：可使用不小于 0 的数值作为 ID

**使用示例**：

```c
ysm.play_sound(1, 'sample')   // 创建 ID 为 1 的播放进程
ysm.stop_sound(1)             // 停止 ID 为 1 的播放进程
```

#### 匿名播放进程

在过去版本使用`ysm.play_sound`时若存在相同`id`的播放进程，如果指定了“强制播放”会停止旧的播放进程并创建新的，如果未指定则忽略本次播放操作。

新版本加入了“匿名播放进程”的概念：当`id`参数为 0 时，会忽略同名的播放进程并创建新的播放进程，可实现若干个同名播放进程同时存在的效果（此时“强制播放”无效）。

注意：

- 匿名播放进程仍然受“播放上下文”影响；
- `ysm.stop_sound`无法停止匿名播放进程；
- `ysm.stop_all_sounds`会停止所有匿名播放进程；
- 动画音效帧、动画控制器音效创建的都是匿名播放进程。

### Opus 音频支持

新版本对 Opus 解码器进行了全面优化，显著提升了音频播放效果。

**Opus 格式优势**：相较于目前广泛使用的 Vorbis 格式，Opus 具有更优秀的压缩算法，在相同文件大小下可以提供更高的音频质量。

**工具支持**：我们将发布专用的高质量 Opus 编码工具。如您希望提前体验，可以使用 FFmpeg 进行格式转换。
